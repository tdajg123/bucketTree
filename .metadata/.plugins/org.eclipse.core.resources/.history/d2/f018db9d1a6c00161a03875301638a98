<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.ac.BucketTree.FriendMapper">
	<!-- 메신저에서 쓸 친구 목록(새로운메세지 보낸 친구 제외) -->
	<select id="FriendByMessagener" resultType="kr.ac.BucketTree.vo.FriendVO">
		SELECT u.idx, u.name, u.birth
		FROM Friend f join [User] u
		on f.toUser=u.idx
		where (f.fromUser=#{idx} and f.state=1) AND 
		( #{srchType}=0 OR (#{srchType}=1 AND CHARINDEX(#{srchText},f.toUser)>1))
		and u.idx not IN (SELECT u.idx FROM [USER] u   
		                 WHERE u.idx IN(
		                 SELECT from_user_idx
		                 FROM Messenger
		                 WHERE to_user_idx =14 and type=1)
	                     )
	</select>
	<!--메세지=>새로운 메세지를 보낸 친구목록 -->
	<select id="FriendByNewMessagener" resultType="kr.ac.BucketTree.vo.FriendVO">
	SELECT  u.idx, u.name, u.birth
    FROM [USER] u
    WHERE u.idx IN(
    SELECT from_user_idx
    FROM Messenger 
    WHERE to_user_idx =14 and type=1
    )
	</select>
</mapper>